 <!DOCTYPE html>
<html>
	<head>
		<title>Sand Game</title>
		// <meta charset="UTF-8">
		<meta name="author" content="Ian Vamossy">
		<link rel="stylesheet" type="text/css" href="style.css">
	</head>
	
	<body>
		<h1>Ian Vamossy - Welcome to Vamossy.com</h1>

		<canvas id="myCanvas" width="800" height="600">Your browser does not support HTML5. Please update to a more modern browser.</canvas>
		<script>
			var canvas = document.getElementById("myCanvas");
			var context = canvas.getContext("2d");
			var GRAVITY = 4;

			var sand = {
				width: 2,
				height: 2
			};

			window.requestAnimFrame = (function(callback) {
				return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame ||
				function(callback) {
					window.setTimeout(callback, 1000 / 60);
				};
			})();

			function getMousePos(canvas, evt) {
				var rect = canvas.getBoundingClientRect();
				return {
					x: evt.clientX - rect.left,
					y: evt.clientY - rect.top
				};
			}

			function drawSand(sand, context) {
				context.beginPath();
				context.rect(sand.x, sand.y, sand.width, sand.height);
				context.fillStyle = '#000000';
				context.fill();

				//context.fillRect(sand.x, sand.y, sand.width, sand.height);
				//context.fillStyle = '#000000';
			}

			function createSand(e){
				var mousePos = getMousePos(canvas, e);
				sand.x = mousePos.x;
				sand.y = mousePos.y;

				//First draw of sand rectangle
				drawSand(sand, context);

				//canvas.addEventListener('mousemove', createSand, false);

				var startTime = (new Date()).getTime();
				animate(sand, canvas, context, startTime);
			}

			//Add sand event listener
			canvas.addEventListener('mousedown', createSand, false);

			function animate(sand, canvas, context, startTime) {
				// update
				var time = (new Date()).getTime() - startTime;

				// pixels / second
				var linearSpeed = GRAVITY;

				var newY = (linearSpeed * time / 1000);

				if(newY < canvas.height - sand.height) {
					sand.y += newY;
				}

				// clear
				context.clearRect(0, 0, canvas.width, canvas.height);

				//Redraw sand every animation frame
				drawSand(sand, context);

				// request new frame
				requestAnimFrame(function() {
					animate(sand, canvas, context, time);
				});
			}
		</script>
	</body>
</html>

